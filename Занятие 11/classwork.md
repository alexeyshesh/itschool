## Регулярные выражения

Иногда нужно понять, соответствует ли строка какому-то шаблону. Например, понять по названию файла, картинка это или нет. 

Название файла с картинкой можнно описать так:

> Строка, в которой сначала идут любые символы (минимум один), а в конце стоит либо .jpg, либо .png, либо .gif, либо ...

Регулярные выражения — это как раз способ записи таких шаблонов. Можно сказать, что это такой отдельный язык. Для работы с регулярными выражениями используется стандартный модуль `re`.

Итак, как же строятся шаблоны? 

1. Если в стркое стоит просто какая-то буква – она читается как эта буква. Шаблон слова “hello” — “hello”

2. Спецсимвол `.` — на этом месте может стоять любой символ. Например, шаблон `ко.` будет соответствовать и слову кот, и слову код, и слову ком.

3. Есть специальные символы, которые отражают какой-то набор символов:

   1. `\w` — любая буква
   2. `\d` — любая цифра
   3. Если спецсимвол большой, то имеется в виду что угодно, кроме элементов этого множества. То есть `\W` — любой символ, но не буква.

   Например, шаблон `цифра \d` будет соответствовать строке `цифра 5`, но не будет соответствовать строке `цифра i`

4. Есть символы, которые называются модификаторами. Они говорят о количестве повторений предыдущего символа.

   1. `a*` — символ перед `*` повторяется 0 или более раз, то есть под шаблон попадет и пустая строка, и `a`, и `aaa`
   2. `a+` — символ перед `+` повторяется 1 или более раз, то есть единственное отличие от `*` в том, что не подходит пустая строка
   3. `ab?` — символ перед `?` либо есть, либо его нет. То есть под этот шаблон подходит и строка `a`, и строка `ab`
   4. `a{3}` — в фигурных скобках указывается количество повторений символа, идущего перед модификатором. То есть под этот шаблон попадает строка `aaa`

5. Последовательности символов можно групппировать в скобки. То есть под шаблон `(ab)+` будут попадать строки `ab`, `ababab` и так далее

6. Если есть несколько вариантов, как например с расширением файла-картинки, используется символ `|`. Под шаблон `a(b|c|d)` попадают строки `ab`, `ac`, `ad`

7. Ну и последнее — один символ из множества. Множества запиисываются в квадратных скобках без разделителей. То есть `[abc]` — это либо a, либо b, либо c, `[abc]+` — любая ннепустая последовательность из букв a, b и c. С помощью `-` внутри множества указыывать диапазон. Например, `[а-я]` — любая русская буква.

8. Если нужно вписать в шаблон символ, который является спецсимволом, перед ним ставится `\`. Например, шаблон `a.txt` будет удовлетворять и строке `abtxt`, и строке `a.txt`: потому что точка — спецсимвол. А вот `a\.txt` будет соответствовать только строке `a.txt`. Кроме того, символы `$` и `^` тоже специальные ии перед ними надо ставить `\`. Их работу сейчас обсуждать не будем

Чтобы проверить, что строка соответствует регулярному выражению, используется функция `re.match(шаблон, строка)`. Она выдает `True`, если строка соответствует шаблону, и `False` иначе.



### Примеры

**Пример 1.** Составить регулярное выражение, соответствующее имени пользователя Instagram.

**Решение.** Итак, какие есть условия для имени пользователя:

- Оно начинается с символа @
- Оно содержит только латинские буквы, цифры и нижние подчеркивания
- После @ первый символ — буква
- В имени пользователя не менее четырех символов

Напишем шаблон:

1. Сначала `@`
2. Затем буква: `@\w`
3. Затем три символа, либо буква, либо цифра, либо _: `@\w[\w\d_]{3}`
4. После этого любое число букв, цифр и нижних подчеркиваний: `@\w[\w\d_]{3}[\w\d_]*`
5. Готово

**Пример 2.** Составить ругелярное выражение, соответствующее российскому номеру телефона

**Решение.** Снова разберем по порядку:

1. Сначала идет либо `8`, либо `+7`. При это + — спецсимвол, не забываем поставить обратный слеш: `(8|\+7)`
2. Дальше десять цифр: `(8|\+7)\d{10}`
3. Готово

**Пример 3.** Составить регулярное выражение, соответствующее названию аккорда (для музыкантов).

**Решение.** Делаем:

1. Сначала идет название ноты — это одна из 8 букв: `[ABCDEFGH]`
2. Далее может идти либо символ бемоль, либо символ диез, либо ничего из них: `[ABCDEFGH](b|#)?`
3. Далее может идти знак минора или нечто более сложное — не будем перечислять всё: `[ABCDEFGH](b|#)?(m|maj7|sus2|sus4)?`
4. Готово

**Пример 4.** Составить регулярное выражение, соответствующее дате в формате `DD.MM.YYYY` (например, `03.04.2021`)

**Решение.** Делаем:

1. День — число от 01 до 31. В феврале максимум 29 дней, но не будем сильно усложнять. В целом, всё возможно. Итак, как задать число от 01 до 31. Если первая цифра — 0, 1 или 2, то вторая — от нуля до девяти; если первая цифра 3 — вторая либо 0, либо 1. Другой первой цифры быть не может. Так и запишем: `([012]\d|30|31)`
2. Дальше идет точка и месяц. Месяц — число от 01 до 12. Аналогично: если первая цифра 0, то вторая — любая, если первая — 1, то вторая либо 0, либо 1, либо 2. Точка — спецсимвол, поэтому не забываем про `\`. Пишем: `([012]\d|30|31)\.(0\d|1[012])`
3. Ну и дальше год, Будем считать, что это любое четырехзначное число: `([012]\d|30|31)\.(0\d|1[012])\.\d\d\d\d`
4. Готово

**Пример 5.** Составить регулярное выражение, соответствующее адресу электронной почты.

**Решение.** Почта состоит из двух частей — название ящика и сайт, на котором заведен этот ящик.

1. Ящик — буквы, нижние подчеркивания, цифры, тире, начинается с буквы: `\w[\w\d_\-]*`
2.  Дальше символ @ и название сайта. Для простоты будем считать, что название сайта может состоять из букв и цифр в любом порядке: `\w[\w\d_\-]*@[\w\d]+`
3. Дальше идет точка и домен. Можно либо перечислить домены, что не очень хорошо, либо просто считать, что это от двух до четырех букв: `\w[\w\d_\-]*@[\w\d]+\.\w\w\w?\w?`
4. Готово



Кроме метода для проверки, есть еще два важных:

- `re.finall(шаблон, строка)` — возвращает список подстрок из строки, соответствующих шаблону
- `re.sub(a, b, c)` — заменяет подстроки, соответствующие шаблону a, на строки b в строке c.